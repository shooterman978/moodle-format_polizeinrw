/* ============================================
   Polizei NRW Course Format - Styles
   ============================================ */

/* ============================================
   CSS Custom Properties (Design Tokens)
   ============================================ */
:root {
    /* Template-Farben (werden per JavaScript aus den Kurseinstellungen gesetzt) */
    /* Fallback: Polizei Blau Template */
    --polizeinrw-template-color: #1a2e56;
    --polizeinrw-template-secondary: #475777;
    --polizeinrw-template-notice: #e8e227;
    --polizeinrw-template-notice-text: #1a2e56;
    --polizeinrw-template-text: #fff;
    --polizeinrw-template-activity-icon: #1a2e56;
    --polizeinrw-template-activity-icon-bg: #fff;

    /* Polizei NRW Farben */
    --polizeinrw-primary: #2d1b4e;
    --polizeinrw-primary-light: #3d2b5e;
    /* Akzentfarbe verwendet jetzt die Template-Hauptfarbe */
    --polizeinrw-accent: var(--polizeinrw-template-color);
    --polizeinrw-completion-yellow: #f7e135;
    --polizeinrw-completion-check: #2d1b4e;
    --polizeinrw-card-bg: #fff;
    --polizeinrw-card-shadow: rgba(0, 0, 0, 0.1);
    --polizeinrw-card-hover-shadow: rgba(0, 0, 0, 0.15);
    --polizeinrw-text-dark: #333;
    --polizeinrw-text-light: #fff;
    --polizeinrw-hidden-opacity: 0.6;

    /* Card Dimensionen */
    --polizeinrw-card-width: 180px;
    --polizeinrw-card-height: 160px;
    --polizeinrw-card-radius: 16px;
    --polizeinrw-icon-size: 80px;
    --polizeinrw-completion-size: 32px;
    --polizeinrw-grid-gap: 24px;
}

/* ============================================
   Section Styling
   ============================================ */
.format-polizeinrw-section {
    position: relative;
    z-index: 1;
    /* Stelle sicher, dass Sections keinen Stacking Context erstellen, der Dropdowns überlappt */
    isolation: auto;
}

/* Section Content Container - der äußere Container mit Hintergrund */
.format-polizeinrw-section .section-item.polizeinrw-section-content {
    position: relative;
    display: flex;
    align-items: stretch;
    background-color: #f5f5f5;
    border-radius: 0;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    /* overflow: hidden entfernt, damit Dropdown-Menüs nicht abgeschnitten werden */
    overflow: visible;
    margin-bottom: 20px;
    /* Überschreibe Standard-Moodle-Styles */
    padding: 0;
    border: none;
}

/* Minimale Höhe für eingeklappte Sections (nur Header sichtbar) */
.format-polizeinrw-section:has(.content.collapse:not(.show)) .polizeinrw-section-content {
    min-height: 65px;
    height: 65px;
}

/* Fallback: Minimale Höhe für alle Sections (wird für eingeklappte überschrieben) */
.format-polizeinrw-section .polizeinrw-section-content {
    min-height: auto;
}

/* Linker Rand (farbiger Balken) INNERHALB der Section */
.polizeinrw-section-bar {
    flex-shrink: 0;
    width: 65px;
    background-color: var(--polizeinrw-template-secondary);
    overflow: hidden;
    /* Keine border-radius, da er am linken Rand der Section ist */
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}

/* Abschnittsbild im Balken */
.polizeinrw-section-bar .polizeinrw-section-image {
    width: 50px;
    height: 50px;
    object-fit: cover;
    border-radius: 4px;
    /* Zentrierung */
    display: block;
    margin: auto;
}

/* Innerer Content-Bereich */
.polizeinrw-section-inner {
    flex: 1;
    min-width: 0;
    padding: 20px;
    /* overflow: visible, damit Dropdown-Menüs sichtbar sind */
    overflow: visible;
    position: relative;
    background-color: var(--polizeinrw-template-color);
    color: var(--polizeinrw-template-text);
}

/* Links im Section-Inner verwenden die Template-Schriftfarbe */
.polizeinrw-section-inner a,
.polizeinrw-section-inner .activity a,
.polizeinrw-section-inner .activityname a,
.polizeinrw-section-inner .activity-link,
.polizeinrw-section-inner .activitytitle a,
.polizeinrw-section-inner .activityinstance a {
    color: var(--polizeinrw-template-text)!important;
}

.polizeinrw-section-inner a:hover,
.polizeinrw-section-inner a:focus,
.polizeinrw-section-inner .activity a:hover,
.polizeinrw-section-inner .activity a:focus,
.polizeinrw-section-inner .activityname a:hover,
.polizeinrw-section-inner .activityname a:focus,
.polizeinrw-section-inner .activity-link:hover,
.polizeinrw-section-inner .activity-link:focus,
.polizeinrw-section-inner .activitytitle a:hover,
.polizeinrw-section-inner .activitytitle a:focus,
.polizeinrw-section-inner .activityinstance a:hover,
.polizeinrw-section-inner .activityinstance a:focus {
    color: var(--polizeinrw-template-text);
    text-decoration: underline;
}

/* Reduziertes Padding für eingeklappte Sections (nur Header sichtbar) */
/* Wenn der Content-Bereich eingeklappt ist, reduziere das Padding des inneren Containers */
.format-polizeinrw-section:has(.content.collapse:not(.show)) .polizeinrw-section-inner {
    padding-top: 8px;
    padding-bottom: 8px;
}

/* Zusätzlich: Reduziere auch die Höhe des Headers für eingeklappte Sections */
.format-polizeinrw-section:has(.content.collapse:not(.show)) .course-section-header {
    min-height: auto;
    padding-left: 0;
    padding-right: 0;
    padding-top: 9px;
    padding-bottom: 9px;
}

/* Header-Bereich der Section - muss overflow: visible haben für Dropdowns */
.polizeinrw-section-inner .course-section-header {
    overflow: visible;
    position: relative;
    z-index: 1;
    display: flex;
    align-items: center;
    /* Minimale Höhe für den Header, damit eingeklappte Sections konsistent sind */
    min-height: 36px;
}

/* Toggle-Button (Einklappen/Ausklappen) - durchsichtiger Hintergrund */
.polizeinrw-section-toggle,
.polizeinrw-section-toggle.btn-icon,
.polizeinrw-section-toggle .expanded-icon,
.polizeinrw-section-toggle .collapsed-icon,
.polizeinrw-section-toggle .expanded-icon.p-2,
.polizeinrw-section-toggle .collapsed-icon.p-2 {
    background-color: transparent!important;
}

.polizeinrw-section-toggle:hover,
.polizeinrw-section-toggle.btn-icon:hover {
    background-color: rgba(255, 255, 255, 0.1);
}

/* Minimale Höhe für eingeklappte Sections wird durch min-height: 76px
   auf .polizeinrw-section-content gesteuert (siehe oben) */

/* Collapse-Container - muss overflow: hidden haben, damit der Inhalt nicht abgeschnitten wird */
.format-polizeinrw-section .content.collapse,
.format-polizeinrw-section .course-content-item-content {
    overflow: hidden;
}

/* ============================================
   Activity Grid Layout
   ============================================ */
.polizeinrw-activity-grid {
    display: grid;
    /* Automatisch so viele Spalten wie passen, mit fester Card-Breite */
    grid-template-columns: repeat(auto-fill, var(--polizeinrw-card-width));
    gap: var(--polizeinrw-grid-gap);
    padding: 20px 20px;
    /* Zentriere die Cards wenn nicht alle Spalten gefüllt sind */
    /*justify-content: center;*/
    /* overflow: visible, damit Dropdown-Menüs nicht abgeschnitten werden */
    overflow: visible;
    position: relative;
}


/* ============================================
   Activity Card Wrapper
   ============================================ */
.polizeinrw-activity-card-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    position: relative;
    /* WICHTIG: Feste Breite für einheitliche Kacheln */
    width: var(--polizeinrw-card-width);
    max-width: 100%;
    /* overflow: visible, damit Dropdown-Menüs nicht abgeschnitten werden */
    overflow: visible;
    z-index: 1;
}

.polizeinrw-activity-card-wrapper.hiddenactivity {
    opacity: var(--polizeinrw-hidden-opacity);
}

/* ============================================
   Activity Card
   ============================================ */
.polizeinrw-activity-card {
    position: relative;
    /* WICHTIG: Feste Größe für alle Cards gleich */
    width: var(--polizeinrw-card-width);
    height: var(--polizeinrw-card-width);
    max-width: 100%;
    background: var(--polizeinrw-template-activity-icon-bg);
    border-radius: var(--polizeinrw-card-radius);
    box-shadow: 0 4px 12px var(--polizeinrw-card-shadow);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    overflow: visible;
}

/* Hover auf der CARD-WRAPPER (dem Parent) triggert den Card-Effekt */
.polizeinrw-activity-card-wrapper:hover .polizeinrw-activity-card {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px var(--polizeinrw-card-hover-shadow);
}

/* ============================================
   Card Link (ganzer Card klickbar)
   ============================================ */
.polizeinrw-card-link {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    text-decoration: none;
    color: inherit;
    border-radius: var(--polizeinrw-card-radius);
    /* Niedrigerer z-index als Completion Badge */
    position: relative;
    z-index: 1;
}

.polizeinrw-card-link:hover,
.polizeinrw-card-link:focus {
    text-decoration: none;
    color: inherit;
    outline: none;
}

.polizeinrw-card-link:focus-visible {
    outline: 3px solid var(--polizeinrw-accent);
    outline-offset: 2px;
}

/* Im Bearbeitungsmodus: Link deaktivieren, damit Bearbeitungs-Icons klickbar sind */
.editing .polizeinrw-card-link {
    pointer-events: none;
    cursor: default;
}

/* ============================================
   Card Body (Icon Container)
   ============================================ */
.polizeinrw-card-body {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    padding: 20px;
}

/* ============================================
   Activity Icon
   ============================================ */
.polizeinrw-card-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    /* Hintergrundfarbe entfernt - wird jetzt auf der gesamten Card gesetzt */
    border-radius: 50%;
    width: calc(var(--polizeinrw-icon-size) + 20px);
    height: calc(var(--polizeinrw-icon-size) + 20px);
    margin: 0 auto;
}

.polizeinrw-activity-icon {
    width: var(--polizeinrw-icon-size);
    height: var(--polizeinrw-icon-size);
    object-fit: contain;
    /* Icon-Färbung: Zuerst auf Schwarz setzen, dann mit sepia und hue-rotate auf Template-Farbe */
    filter: brightness(0) saturate(100%);
    /* Die Icon-Farbe wird durch einen CSS-Filter gesetzt */
    /* Da SVG-Icons als <img> eingebunden sind, können wir sie nicht direkt färben */
    /* Stattdessen verwenden wir einen Filter, der die Farbe annähert */
    /* Für eine präzise Farbanpassung müsste das Icon als inline SVG eingebunden werden */
}

/* ============================================
   Completion Badge (oben rechts auf der Card)
   Badge ist jetzt im Wrapper (außerhalb der Card) positioniert
   ============================================ */
.polizeinrw-completion-badge {
    position: absolute;
    /* Positioniert relativ zum Wrapper, oben rechts auf der Card */
    top: -8px;
    right: -8px;
    /* Hoher z-index - Badge liegt ÜBER allem */
    z-index: 100;
    /* Stellt sicher, dass Hover-Events funktionieren */
    pointer-events: auto;
}
.polizeinrw-completion-badge:hover {
    transform: translateY(-4px);
    /*box-shadow: 0 8px 24px var(--polizeinrw-card-hover-shadow);*/
}


/* ==== Basis-Styling für Completion Circle ==== */
.polizeinrw-completion-circle {
    /* Position für Tooltip */
    position: relative;
    /* Feste Größe */
    width: var(--polizeinrw-completion-size);
    height: var(--polizeinrw-completion-size);
    border-radius: 50%;
    /* Zentrierung */
    display: inline-flex;
    align-items: center;
    justify-content: center;
    /* Styling */
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
    cursor: pointer;
    border: none;
    padding: 0;
    margin: 0;
    background: transparent;
    /* Transition */
    transition: background-color 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
    /* Hoher z-index für Hover-Priorität */
    z-index: 101;
}

/* Hover-Effekt: Schatten verstärken */
.polizeinrw-completion-circle:hover {
    /*box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);*/
    /* Noch höherer z-index bei Hover für Tooltip */
    z-index: 200;
}

/* Automatische/Readonly Completion - kein Cursor */
.polizeinrw-completion-circle.polizeinrw-auto,
.polizeinrw-completion-circle.polizeinrw-readonly {
    cursor: default;
}

/* ==== ABGESCHLOSSEN - Template-Hinweisfarbe Kreis mit Häkchen ==== */
.polizeinrw-completion-circle.polizeinrw-complete {
    background-color: var(--polizeinrw-template-notice);
}

.polizeinrw-completion-circle.polizeinrw-complete .polizeinrw-checkmark {
    font-size: 18px;
    font-weight: 900;
    color: var(--polizeinrw-completion-check);
    line-height: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    /* Verwende ein sauberes Häkchen-Symbol */
    font-family: Arial, sans-serif;
}

/* ==== NICHT ABGESCHLOSSEN - Weißer Kreis mit grauem Häkchen ==== */
.polizeinrw-completion-circle.polizeinrw-incomplete {
    background-color: #fff;
    border: 2px solid #ccc;
}

/* Graues Häkchen für nicht abgeschlossene Aktivitäten */
.polizeinrw-completion-circle.polizeinrw-incomplete .polizeinrw-checkmark {
    font-size: 18px;
    font-weight: 900;
    color: #ccc;
    line-height: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: Arial, sans-serif;
}

/* ==== Hover-Effekte für interaktive Buttons ==== */
.polizeinrw-completion-circle.polizeinrw-complete:hover:not(.polizeinrw-auto):not(.polizeinrw-readonly) {
    background-color: var(--polizeinrw-template-notice);
    opacity: 0.9;
}

.polizeinrw-completion-circle.polizeinrw-incomplete:hover:not(.polizeinrw-auto):not(.polizeinrw-readonly) {
    background-color: #f5f5f5;
    border-color: #999;
}

/* ==== Tooltip für Completion Status ==== */
.polizeinrw-tooltip {
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    margin-bottom: 8px;
    padding: 6px 12px;
    background-color: #333;
    color: #fff;
    font-size: 12px;
    font-weight: 500;
    white-space: nowrap;
    border-radius: 4px;
    /*box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);*/
    /* Versteckt bis Hover */
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.2s ease, visibility 0.2s ease;
    /* Kein Pointer Events */
    pointer-events: none;
    z-index: 1000;
}

/* Tooltip-Pfeil */
.polizeinrw-tooltip::after {
    content: "";
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    border-width: 5px;
    border-style: solid;
    border-color: #333 transparent transparent transparent;
}

/* Tooltip bei Hover anzeigen */
.polizeinrw-completion-circle:hover .polizeinrw-tooltip,
.polizeinrw-completion-circle:focus .polizeinrw-tooltip {
    opacity: 1;
    visibility: visible;
}

/* Checkmark und Tooltip dürfen keine Maus-Events abfangen */
.polizeinrw-completion-circle .polizeinrw-checkmark,
.polizeinrw-completion-circle .polizeinrw-tooltip {
    pointer-events: none;
}

/* ==== Focus Styles für Barrierefreiheit ==== */
.polizeinrw-completion-circle:focus {
    outline: 3px solid var(--polizeinrw-accent);
    outline-offset: 2px;
}

.polizeinrw-completion-circle:focus:not(:focus-visible) {
    outline: none;
}

.polizeinrw-completion-circle:focus-visible {
    outline: 3px solid var(--polizeinrw-accent);
    outline-offset: 2px;
}

/* Reduzierte Bewegung für Barrierefreiheit */
@media (prefers-reduced-motion: reduce) {
    .polizeinrw-tooltip {
        transition: none;
    }
}

/* ============================================
   Completion Badge (oben rechts auf der Card)
   Badge ist jetzt im Wrapper (außerhalb der Card) positioniert
   ============================================ */
.polizeinrw-completion-badge {
    position: absolute;
    /* Positioniert relativ zum Wrapper, oben rechts auf der Card */
    top: -8px;
    right: -8px;
    /* Hoher z-index - Badge liegt ÜBER allem */
    z-index: 100;
    /* Stellt sicher, dass Hover-Events funktionieren */
    pointer-events: auto;
}

/* Completion Badge im Bearbeitungsmodus ausblenden */
.editing .polizeinrw-completion-badge {
    display: none;
}

.polizeinrw-completion-badge:hover {
    transform: translateY(-4px);
    /*box-shadow: 0 8px 24px var(--polizeinrw-card-hover-shadow);*/
}

/* ============================================
   Visibility Badge (versteckt)
   ============================================ */
.polizeinrw-visibility-badge {
    position: absolute;
    top: -8px;
    left: -8px;
    z-index: 10;
    width: 28px;
    height: 28px;
    background: #ff9800;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    /*box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);*/
}

.polizeinrw-visibility-badge img {
    width: 16px;
    height: 16px;
    filter: brightness(0) invert(1);
}

/* ============================================
   Card Title (Name unter der Card)
   ============================================ */
.polizeinrw-card-title {
    margin-top: 12px;
    padding: 0 8px;
    max-width: var(--polizeinrw-card-width);
    width: 100%;
    /* Niedrigerer z-index, damit Dropdown-Menüs darüber liegen */
    position: relative;
    z-index: 1;
}

.polizeinrw-card-title .inplaceeditable {
    display: block;
}

.polizeinrw-card-title a,
.polizeinrw-card-title .inplaceeditable a {
    color: var(--polizeinrw-text-dark);
    text-decoration: none;
    font-size: 14px;
    font-weight: 500;
    line-height: 1.3;
    display: -webkit-box;
    /* Limit the title to 3 lines */
    line-clamp: 3;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
    word-break: break-word;
}

.polizeinrw-card-title a:hover {
    color: var(--polizeinrw-accent);
    text-decoration: underline;
}

/* ============================================
   Card Actions (Bearbeitungsmenü)
   ============================================ */
.polizeinrw-card-actions {
    position: absolute;
    /* Standard: unten rechts auf der Card (nur bei Hover sichtbar) */
    bottom: 8px;
    right: 8px;
    z-index: 100;
    opacity: 0;
    transition: opacity 0.2s ease, top 0.2s ease, bottom 0.2s ease, right 0.2s ease;
    /* WICHTIG: pointer-events aktivieren, damit Icons klickbar sind */
    pointer-events: auto;
}

/* Bei Hover: Bearbeitungsmenü sichtbar (nur außerhalb des Bearbeitungsmodus) */
.polizeinrw-activity-card-wrapper:hover .polizeinrw-card-actions {
    opacity: 1;
}

/* Im Bearbeitungsmodus: Bearbeitungsmenü oben rechts (wo das Badge normalerweise ist) */
/* Position relativ zum Wrapper, genau wie das Badge */
body.editing .polizeinrw-activity-card-wrapper .polizeinrw-card-actions,
.editing .polizeinrw-activity-card-wrapper .polizeinrw-card-actions {
    opacity: 1;
    /* Position relativ zum Wrapper, genau wie das Badge - oben rechts auf der Card */
    position: absolute;
    top: -8px;
    right: -8px;
    bottom: auto;
    left: auto;
    /* Stelle sicher, dass es über der Card liegt */
    z-index: 200;
}

.polizeinrw-card-actions .dropdown-toggle {
    background: rgba(255, 255, 255, 0.9);
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 4px 8px;
    /* WICHTIG: pointer-events aktivieren */
    pointer-events: auto;
    cursor: pointer;
    /* Normale Schriftfarbe für Buttons (nicht Template-Schriftfarbe) */
    color: var(--polizeinrw-text-dark);
}

/* Buttons und Icons in Card-Actions verwenden normale Farbe */
.polizeinrw-card-actions .btn,
.polizeinrw-card-actions .btn-icon,
.polizeinrw-card-actions .dropdown-toggle,
.polizeinrw-card-actions [id^="action-menu-toggle-"],
.polizeinrw-card-actions a.btn,
.polizeinrw-card-actions button {
    color: var(--polizeinrw-text-dark) !important;
}

.polizeinrw-card-actions .btn:hover,
.polizeinrw-card-actions .btn-icon:hover,
.polizeinrw-card-actions .dropdown-toggle:hover,
.polizeinrw-card-actions [id^="action-menu-toggle-"]:hover,
.polizeinrw-card-actions a.btn:hover,
.polizeinrw-card-actions button:hover {
    color: var(--polizeinrw-accent);
    background-color: rgba(255, 255, 255, 1);
}

/* Action Menu und alle Bearbeitungs-Icons müssen klickbar sein */
.polizeinrw-card-actions .action-menu,
.polizeinrw-card-actions [id^="action-menu-"],
.polizeinrw-card-actions .dropdown-toggle,
.polizeinrw-card-actions button,
.polizeinrw-card-actions a {
    pointer-events: auto;
    z-index: 201;
    position: relative;
}

/* Dropdown-Menü der Card-Actions muss über allem liegen */
.polizeinrw-card-actions .dropdown-menu,
.polizeinrw-card-actions .dropdown-menu.show,
.polizeinrw-card-actions [id^="action-menu-"] .dropdown-menu,
.polizeinrw-card-actions [id^="action-menu-"] .dropdown-menu.show {
    z-index: 10000;
    position: absolute;
    overflow: visible;
    /* Normale Schriftfarbe für Dropdown-Menüs (nicht Template-Schriftfarbe) */
    color: var(--polizeinrw-text-dark);
    background-color: #fff;
}

/* Links in Card-Actions Dropdown-Menüs */
.polizeinrw-card-actions .dropdown-menu a,
.polizeinrw-card-actions .dropdown-menu.show a,
.polizeinrw-card-actions [id^="action-menu-"] .dropdown-menu a {
    color: var(--polizeinrw-text-dark);
}

.polizeinrw-card-actions .dropdown-menu a:hover,
.polizeinrw-card-actions .dropdown-menu.show a:hover,
.polizeinrw-card-actions [id^="action-menu-"] .dropdown-menu a:hover {
    color: var(--polizeinrw-accent);
    background-color: #f8f9fa;
}

/* ============================================
   Card Availability Info
   ============================================ */
.polizeinrw-card-availability {
    margin-top: 8px;
    font-size: 12px;
    max-width: var(--polizeinrw-card-width);
}

.polizeinrw-card-availability .badge {
    font-size: 10px;
    padding: 4px 8px;
}

/* ============================================
   Bulk Select (für Massenbearbeitung)
   ============================================ */
.polizeinrw-bulk-select {
    position: absolute;
    top: -8px;
    left: -8px;
    z-index: 15;
}

/* ============================================
   Move Here Indicator
   ============================================ */
.polizeinrw-movehere {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 60px;
    border: 2px dashed var(--polizeinrw-accent);
    border-radius: var(--polizeinrw-card-radius);
    background: rgba(0, 102, 204, 0.05);
}

.polizeinrw-movehere a.movehere {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* ============================================
   Card Item Wrapper im Grid
   ============================================ */
.polizeinrw-card-item {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    /* Stelle sicher, dass das Grid-Item die richtige Größe hat */
    width: var(--polizeinrw-card-width);
}

/* ============================================
   Inline-Aktivitäten (Labels, Textfelder, etc.)
   Diese werden NICHT als Cards angezeigt, sondern
   im Moodle-Standard-Layout (volle Breite)
   ============================================ */

/* Inline-Aktivitäten nehmen volle Breite im Grid */
.polizeinrw-card-item:has(.activityinline),
.polizeinrw-card-item:has(.activity-item:not(.polizeinrw-activity-card-wrapper)) {
    grid-column: 1 / -1;
    width: 100%;
    display: block;
}

/* Standard Moodle Styling für Inline-Aktivitäten */
.polizeinrw-activity-grid .activity-item.activityinline {
    background: transparent;
    padding: 16px 0;
    margin: 8px 0;
    border-bottom: 1px solid #eee;
    width: 100%;
}

.polizeinrw-activity-grid .activity-item:not(.polizeinrw-activity-card-wrapper) {
    width: 100%;
    background: transparent;
    border: none;
    border-radius: 8px;
    padding: 16px 0;
    margin: 8px 0;
}

/* Entferne Card-Styling für Nicht-Card Aktivitäten */
.polizeinrw-activity-grid .activity-item:not(.polizeinrw-activity-card-wrapper) .activity-grid {
    display: flex;
    flex-wrap: wrap;
    align-items: flex-start;
    gap: 12px;
}

/* Fallback für Browser ohne :has() Support */
@supports not selector(:has(*)) {
    .polizeinrw-card-item.has-inline-activity {
        grid-column: 1 / -1;
        width: 100%;
        display: block;
    }
}

/* ============================================
   Anpassungen für den Bearbeitungsmodus
   ============================================ */
.editing .polizeinrw-activity-card {
    cursor: move;
}

/* Diese Regel wurde in die spezifischere Regel oben verschoben */

/* Im Bearbeitungsmodus: Card-Link deaktivieren, damit Bearbeitungs-Icons funktionieren */
.editing .polizeinrw-card-link {
    pointer-events: none;
    cursor: default;
}

/* Im Bearbeitungsmodus: Card-Body sollte auch keine pointer-events blockieren */
.editing .polizeinrw-card-body {
    pointer-events: none;
}

/* Im Bearbeitungsmodus: Alle Bearbeitungs-Elemente müssen klickbar sein */
.editing .polizeinrw-card-actions,
.editing .polizeinrw-bulk-select,
.editing .polizeinrw-visibility-badge,
.editing .polizeinrw-completion-badge {
    pointer-events: auto;
    z-index: 200;
    position: relative;
}

/* Inplace-Editable (Stift-Icon) muss auch klickbar sein */
.editing .polizeinrw-card-title .inplaceeditable,
.editing .polizeinrw-card-title .inplaceeditable a,
.editing .polizeinrw-card-title a {
    pointer-events: auto;
    z-index: 200;
    position: relative;
}

/* Dropdown-Menüs im Bearbeitungsmodus müssen immer sichtbar sein */
/* Sehr hoher z-index, damit Dropdowns über allen Sections liegen */
.format-polizeinrw-section .dropdown-menu,
.format-polizeinrw-section .dropdown-menu.show {
    z-index: 9999;
    position: absolute;
    /* Stelle sicher, dass Dropdowns nicht abgeschnitten werden */
    overflow: visible;
    /* Normale Schriftfarbe für Dropdown-Menüs (nicht Template-Schriftfarbe) */
    color: var(--polizeinrw-text-dark);
    background-color: #fff;
}

/* Links in Dropdown-Menüs verwenden normale Linkfarbe */
.format-polizeinrw-section .dropdown-menu a,
.format-polizeinrw-section .dropdown-menu.show a,
.format-polizeinrw-section .action-menu .dropdown-menu a,
.format-polizeinrw-section [id^="action-menu-"] .dropdown-menu a {
    color: var(--polizeinrw-text-dark) !important;
}

.format-polizeinrw-section .dropdown-menu a:hover,
.format-polizeinrw-section .dropdown-menu.show a:hover,
.format-polizeinrw-section .action-menu .dropdown-menu a:hover,
.format-polizeinrw-section [id^="action-menu-"] .dropdown-menu a:hover {
    color: var(--polizeinrw-accent);
    background-color: #f8f9fa;
}

/* Control Menu Dropdowns in Sections - besonders wichtig für eingeklappte Sections */
.format-polizeinrw-section .polizeinrw-control-menu,
.format-polizeinrw-section .section-control-menu {
    position: relative;
    z-index: 100;
    overflow: visible;
}

.format-polizeinrw-section .polizeinrw-control-menu .dropdown-menu,
.format-polizeinrw-section .section-control-menu .dropdown-menu,
.format-polizeinrw-section .polizeinrw-control-menu .dropdown-menu.show,
.format-polizeinrw-section .section-control-menu .dropdown-menu.show {
    z-index: 9999;
    /* Stelle sicher, dass Dropdowns auch bei eingeklappten Sections sichtbar sind */
    position: absolute;
    overflow: visible;
}

/* Action Menu Dropdowns (für Section Control Menu) */
.format-polizeinrw-section .action-menu .dropdown-menu,
.format-polizeinrw-section .action-menu .dropdown-menu.show,
.format-polizeinrw-section [id^="action-menu-"] .dropdown-menu,
.format-polizeinrw-section [id^="action-menu-"] .dropdown-menu.show {
    z-index: 9999;
    position: absolute;
    overflow: visible;
}

/* Stelle sicher, dass Sections selbst keinen zu hohen z-index haben */
.format-polizeinrw-section {
    position: relative;
    z-index: 1;
}

/* Wenn eine Section ein geöffnetes Dropdown hat, erhöhe den z-index temporär */
.format-polizeinrw-section:has(.dropdown-menu.show) {
    z-index: 100;
}

/* Section-Liste und Course-Format-Container - niedriger z-index, damit Dropdowns darüber liegen */
.format-polizeinrw ul[data-for="course_sectionlist"],
.format-polizeinrw #course-format-,
.format-polizeinrw [id^="course-format-"] {
    position: relative;
    z-index: 1;
}

/* Stelle sicher, dass alle Dropdown-Menüs im Format-Container hohen z-index haben */
.format-polizeinrw .dropdown-menu,
.format-polizeinrw .dropdown-menu.show,
.format-polizeinrw [id^="action-menu-"] .dropdown-menu,
.format-polizeinrw [id^="action-menu-"] .dropdown-menu.show {
    z-index: 9999;
}


/* Falls dunkler Hintergrund gewünscht, Titel anpassen */
.format-polizeinrw.dark-theme .polizeinrw-card-title a {
    color: var(--polizeinrw-text-light);
}

/* ============================================
   Print Styles
   ============================================ */
@media print {
    .polizeinrw-activity-grid {
        display: block;
    }

    .polizeinrw-activity-card-wrapper {
        display: inline-block;
        page-break-inside: avoid;
        margin: 10px;
    }

    .polizeinrw-card-actions,
    .polizeinrw-bulk-select {
        display: none;
    }
}

/* ============================================
   Accessibility
   ============================================ */
@media (prefers-reduced-motion: reduce) {
    .polizeinrw-activity-card,
    .polizeinrw-card-actions {
        transition: none;
    }

    .polizeinrw-activity-card:hover {
        transform: none;
    }
}

/* Focus Styles für Tastaturnavigation */
.polizeinrw-activity-card:focus-within {
    outline: 3px solid var(--polizeinrw-accent);
    outline-offset: 2px;
}

/* ============================================
   Color Picker für Kurseinstellungen
   ============================================ */
.polizeinrw-colorpicker {
    display: flex;
    gap: 12px;
    align-items: center;
    flex-wrap: wrap;
    padding: 8px 0;
}

.polizeinrw-color-circle {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 3px solid transparent;
    cursor: pointer;
    /*transition: transform 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;*/
    /*box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);*/
    padding: 0;
    margin: 0;
}

.polizeinrw-color-circle:hover {
    transform: scale(1.15);
    /*box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);*/
}

.polizeinrw-color-circle.selected {
    border-color: #333;
    /*box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.2), 0 4px 12px rgba(0, 0, 0, 0.3);*/
    transform: scale(1.1);
}

.polizeinrw-color-circle:focus {
    outline: 3px solid var(--polizeinrw-accent, #06c);
    outline-offset: 3px;
}

.polizeinrw-color-circle:focus:not(:focus-visible) {
    outline: none;
}

.polizeinrw-color-circle:focus-visible {
    outline: 3px solid var(--polizeinrw-accent, #06c);
    outline-offset: 3px;
}

/* ============================================
   Schloss-Symbol (Restriction Lock)
   ============================================ */
.polizeinrw-section-inner .restrictionlock img,
.polizeinrw-section-inner [class*="restrictionlock"] img,
.course-section-header .restrictionlock img,
.course-section-header [class*="restrictionlock"] img {
    filter: brightness(0) saturate(100%) invert(1);
    /* Verwende Template-Hinweisfarbe durch CSS-Filter */
    /* Da wir die Farbe nicht direkt setzen können, verwenden wir einen Filter */
    /* Für gelb (#FFD700) müssen wir einen speziellen Filter verwenden */
}

/* Alternative: Verwende CSS-Mask oder direktes Styling wenn möglich */
.polizeinrw-section-inner .restrictionlock,
.polizeinrw-section-inner [class*="restrictionlock"],
.course-section-header .restrictionlock,
.course-section-header [class*="restrictionlock"] {
    color: var(--polizeinrw-template-notice);
}

.polizeinrw-section-inner .restrictionlock svg,
.polizeinrw-section-inner [class*="restrictionlock"] svg,
.course-section-header .restrictionlock svg,
.course-section-header [class*="restrictionlock"] svg {
    fill: var(--polizeinrw-template-notice);
    color: var(--polizeinrw-template-notice);
}

/* ============================================
   Availability Info (Verfügbarkeitsinformationen)
   ============================================ */
.polizeinrw-section-inner .availabilityinfo,
.polizeinrw-section-inner .section_availability .availabilityinfo,
.polizeinrw-section-inner .availabilityinfo.isrestricted {
    background-color: var(--polizeinrw-template-notice);
    color: var(--polizeinrw-template-notice-text);
    padding: 8px 12px;
    border-radius: 4px;
    margin: 8px 0;
}

.polizeinrw-section-inner .availabilityinfo a,
.polizeinrw-section-inner .section_availability .availabilityinfo a,
.polizeinrw-section-inner .availabilityinfo.isrestricted a {
    color: var(--polizeinrw-template-notice-text) !important;
    text-decoration: underline;
}

.polizeinrw-section-inner .availabilityinfo a:hover,
.polizeinrw-section-inner .section_availability .availabilityinfo a:hover,
.polizeinrw-section-inner .availabilityinfo.isrestricted a:hover {
    color: var(--polizeinrw-template-notice-text) !important;
    text-decoration: underline;
}
